"use strict";self.dataLit=null;class LitGirl{constructor(e=null){this.rootLit=null!=e.rootDir?e.rootDir+"/litgirl":"litgirl",this.urlBase=`${location.protocol}//${location.host}/${this.rootLit}/`,this.string=null,this.data=e&&null!=e.data?e.data:null,this.data||e&&e.dataUrl&&this.getModule(e.dataUrl.url,null,e.dataUrl.name).then((e=>{this.data=e})).catch((t=>{console.error(`Loading Error in ${e.dataUrl.url}:\n ${t}`)})),this.output=e&&e.output?e.output:null,this.method=e&&e.method?e.method:null,this.operators=["===","==","!=","!==","<",">","<=",">=","<>","&&","||","!","<|>","=","+","++","-","--","*","**","/","%"],this.urlParts=e&&e.urlParts&&e.urlParts.startsWith(/http|\./)?e.urlParts+"/":`${this.urlBase}parts/`,this.urlSrc=e&&e.urlSrc?e.urlSrc+"/":"../src/",this.modules={},this.regCarry=/{{\=([\s\S]+?)\}}/g}async setDataLit(e=null){try{if(e||(e={}),!1!==e.get)!e.get.url&&e.get.file?e.get.url=`${this.urlSrc}${e.get.file}`:e.get.url||e.get.file?e.get.url=`${e.get.url}/${e.get.file}`:e.get.url=`${this.urlSrc}datalit.js`,e.get.name||(e.get.name="default"),this.getModule(e.get.url,null,e.get.name).then((t=>(dataLit&&!0===e.add?datalit=e.set&&e.set.data?Object.assign(datalit,t,e.set.data):Object.assign(datalit,t):datalit=e.set&&e.set.data?Object.assign(t,e.set.data):t,!0===e.replicate&&(this.data=dataLit),dataLit))).catch((e=>{console.log(e.message)}));else if(e.set&&e.set.data)return dataLit&&!0===e.add?datalit=Object.assign(datalit,e.set.data):datalit=e.set.data,!0===e.replicate&&(this.data=dataLit),dataLit;return console.log("CLOSED PROCEDURE WITH ERROR: An incongruence has ocurred trying to process arguments object")}catch(e){return console.error(`Loading error data: ${e}`),!1}}async init(e=null,t=null){const i=document.documentElement.querySelector("head"),l=document.documentElement.querySelector("body");if(null==l){for(;!l||null==l;)if(null!=l){l.style.visibility="hidden";break}}else l.style.visibility="hidden";const r=[i.innerHTML.match(this.regCarry),l.innerHTML.match(this.regCarry)];for(let i=0;i<r.length;i++)r[i]&&this.carry(r[i],e).then((e=>(t||(t={data:null,output:0===i?"head":"body",method:"inner",url:null}),t.cast=e,this.compile(t))));if(r.some((e=>null!=e))){const e={attributes:!0,childList:!0,subtree:!0},t=function(e,t){for(const t of e)"childList"===t.type?console.log("A child node has been added or removed."):"attributes"===t.type&&console.log("The "+t.attributeName+" attribute was modified.");return t.disconnect(),document.body.style.visibility="visible"};new MutationObserver(t).observe(l,e)}}async carry(e=null,t=null){let i=null,l=null,r="";return new Promise(((s,a)=>{try{e.map((async(a,n)=>{i=a.replace(/{{=|}}/g,"").trim(),i=i.split(/\?|#/);const u=this.fileExtension(i[0]);if(null!=u?u.test(/.html|.htm/)?l=await this.getComponent(`${t||this.urlParts}${i}`):u.test(/.js|.json/)&&(l=await this.getModule(`${t||this.urlSrc}${i}`)):l=await this.getComponent(`${t||this.urlParts}${i}.html`).then((e=>e||this.getModule(`${t||this.urlSrc}${i}.js`))),r+=null!=l?e[n].replace(a,l):void 0,n===e.length-1)return s(r)}))}catch(e){return a(e)}})).then((e=>e)).catch((e=>e))}fileExtension(e=null){return/[.]/.exec(e)?/[^.]+$/.exec(e)[0]:void 0}async getModule(e=null,t=null,i=null){return e?(e=e.startsWith(/http|\./)?e:`${this.urlSrc}${e}`,import(e).then((e=>{if(!e)return!1;if(t&&Array.isArray(t))for(let i of t)"default"===i?this.modules.default=e.default:this.modules[i]=e[i];else t&&"default"!==t?this.modules[t]=e:this.modules.default=e.default;return i&&!0===i.cast?(i.cast=this.modules,this.compile(i)):this.modules})).catch((e=>new Error(`Loading error: ${e}`)))):console.error("An Valid URL o file name with extension is required")}async getComponent(e=null,t=null){if(!e)return console.error("An Valid URL o file name with extension is required");e=e.startsWith(/http|\./)?e:`${this.urlParts}${e}`;const i=new Headers({Accept:"text/html"});return fetch(e,{method:"GET",mode:"cors",cache:"default",credentials:"omit",headers:i,redirect:"follow",referrerPolicy:"origin"}).then((e=>!!e.ok&&e.text())).then((e=>t&&!0===t.cast?(t.cast=e,this.compile(t)):e)).catch((e=>console.error(`Loading error: ${e}`)))}compile(e=null){try{e.data&&(this.data=e.data),e.output&&(this.output=e.output),e.method&&(this.method=e.method),e.cast=e.cast.replace(/\n|\r\n/g,"");const t=e.cast.match(this.regCarry)||null;return t&&t.map((t=>{this.carry(t,e.url||null).then((i=>{e.cast=i?e.cast.replace(t,i):e.cast.replace(t,"unknow")}))})),this.string=e.cast?e.cast:this.string.replace(/\n|\r\n/g,""),this.parserString()}catch(e){return console.error(e)}}parserString(){try{let reg=/{=([\s\S]+?)\}/g,matches=this.string.match(reg);matches.map(((el,i)=>{let pear=el.replace(/{=|}/g,"").trim();this.string=this.string.replaceAll(el,eval(`this.data.${pear}`))}));const exp=/{\>>([\s\S]+?)\}/g,finders=this.string.match(exp);return finders&&this.conditions(finders),this.render()}catch(e){return console.error(e)}}conditions(finders=null){finders.map((t=>{t.replace(new RegExp("\\t","g"),"");let extract=t.replace("{>>","").replace(">>}","");if(extract=extract.trim(),extract.startsWith("role="))this.listExecute(t,extract);else{let stat=extract.split(">>");for(let i=0;i<stat.length;i++){let ev=null;if(!stat[i].includes("out$>")){ev=stat[i].split("$>"),ev[0]=ev[0].trim(),ev[0].startsWith("(")&&ev[0].endsWith(")")&&(ev[0]=ev[0].slice(1,-1).trim());let e=ev[0].split(/\s/),t=[];for(let i=0;i<e.length;i++)if(e[i].startsWith("dataLit"))t.push(e[i]);else{if(!e[i].includes("$_")&&!this.operators.includes(e[i])){e[i].includes("this.data")||parseInt(e[i])?t.push(e[i]):t.push(`this.data.${e[i]}`);continue}t.push(e[i])}t=t.join(""),ev[0]=`(${t})`}if(stat[i].includes("out$>")){ev=stat[i].replace("out$>","").trim(),this.helperEval(t,ev);break}if(eval(ev[0])){this.helperEval(t,ev[1]);break}}}}))}listExecute(e=null,t=null){if((t=t.trim().replace("role=","")).includes("=>")){(t=t.split("=>"))[1]=t[1].replace(new RegExp("\\t","g"),""),t[1]=t[1].split(">>");let i=[];for(let e=0;e<t[1].length;e++)if(t[1][e]=t[1][e].split("$>"),t[1][e][0]=t[1][e][0].trim(),t[1][e][1]=t[1][e][1].trim(),"default"===t[1][e][0])i.push([t[1][e]]);else{t[1][e][0]=t[1][e][0].replace(/\(|\)/g,"");let l=t[1][e][0].split(/\s/),r=[];for(let e=0;e<l.length;e++)if(l[e].startsWith("dataLit"))r.push(l[e]);else{if(!l[e].includes("$_")&&!this.operators.includes(l[e])){l[e].includes("this.data")||parseInt(l[e])?r.push(l[e]):r.push(`this.data.${l[e]}`);continue}r.push(l[e])}r=r.join(""),i.push([`(${r})`,t[1][e][1]])}this.helperList(e,[t[0],i],!0)}else t=t.split("$>"),this.helperList(e,t)}helperList(t=null,ev=null,exec=null){let list="";if(exec||(ev[1]=ev[1].trim().replace(new RegExp("\\t","g"),"")),ev[0]=ev[0].replace(/\(|\)|\s/g,"").split("->"),ev[0][0]=ev[0][0].trim(),ev[0][1]=ev[0][1].trim(),null!=ev[0][1]&&""!=ev[0][1]&&ev[0][1].startsWith("[")&&(ev[0][1]=ev[0][1].replace(/\[|\]|\s/g,""),ev[0][1]=ev[0][1].split(",")),ev[0][0].startsWith("[")?(ev[0][0]=ev[0][0].replace(/\[|\]|\s/g,""),ev[0][0]=ev[0][0].split(",")):parseInt(ev[0][0])&&(ev[0][0]=parseInt(ev[0][0])),ev[0][0]instanceof Array)for(let ind of ev[0][0]){let result=null,toEval=null,isDefault=null;if(ind.includes(".")||!parseInt(ind))if(exec)for(let i=0;i<ev[1].length;i++){if(ev[1][i][0].includes("[i]")&&(ev[1][i][0]=ev[1][i][0].replace("[i]",`[${ind}]`)),ev[1][i][0].includes("default")){result=this.helperEval(null,ev[1][i][1],"get"),isDefault=!0;break}if(eval(ev[1][i][0])){result=this.helperArrays([`${ev[0][1]}.${ind}`]),toEval=ev[1][i][1];break}}else result=this.helperArrays([`${ev[0][1]}.${ind}`]);else if(exec)for(let i=0;i<ev[1].length;i++){if(ev[1][i][0].includes("[i]")&&(ev[1][i][0]=ev[1][i][0].replace("[i]",`[${ind}]`)),ev[1][i][0].includes("default")){result=this.helperEval(null,ev[1][i][1],"get"),isDefault=!0;break}if(eval(ev[1][i][0])){result=this.helperArrays([ev[0][1]],ind),toEval=ev[1][i][1];break}}else result=this.helperArrays([ev[0][1]],ind);list+=exec?isDefault?result:this.helperEval(null,toEval,result):this.helperEval(null,ev[1],result)}else if("number"==typeof ev[0][0])for(let i=0;i<=ev[0][0];i++){let isResolved=null;if(ev[0][1]instanceof Array){if(!exec){list+=this.helperEval(null,ev[1],this.helperArrays(ev[0][1],i));continue}for(let id=0;id<ev[1].length;id++){if(ev[1][id][0].includes("[i]")&&(ev[1][id][0]=ev[1][id][0].replace("[i]",`[${i}]`)),ev[1][id][0].includes("default")){list+=this.helperEval(null,ev[1][id][1],"get"),isResolved=!0;break}if(eval(ev[1][id][0])){list+=this.helperEval(null,ev[1][id][1],this.helperArrays(ev[0][1],i)),isResolved=!0;break}}}else if(ev[0][1].includes(".")){if(!exec){list+=this.helperEval(null,ev[1],this.helperArrays([ev[0][1]],i));continue}for(let id=0;id<ev[1].length;id++){if(ev[1][id][0].includes("[i]")&&(ev[1][id][0]=ev[1][id][0].replace("[i]",`[${i}]`)),ev[1][id][0].includes("default")){list+=this.helperEval(null,ev[1][id][1],"get"),isResolved=!0;break}if(eval(ev[1][id][0])){list+=this.helperEval(null,ev[1][id][1],this.helperArrays([ev[0][1]],i)),isResolved=!0;break}}}isResolved||(list+=this.helperEval(null,ev[1],this.data[ev[0][1]][i]))}else if(ev[0][0].includes("..")){ev[0][0]=ev[0][0].trim().split(".."),ev[0][0][0]=parseInt(ev[0][0][0].trim()),ev[0][0][1]=parseInt(ev[0][0][1].trim());for(let i=ev[0][0][0];i<=ev[0][0][1];i++){let isResolved=null;if(ev[0][1]instanceof Array){if(!exec){list+=this.helperEval(null,ev[1],this.helperArrays(ev[0][1],i));continue}for(let id=0;id<ev[1].length;id++){if(ev[1][id][0].includes("[i]")&&(ev[1][id][0]=ev[1][id][0].replace("[i]",`[${i}]`)),ev[1][id][0].includes("default")){list+=this.helperEval(null,ev[1][id][1],"get"),isResolved=!0;break}if(eval(ev[1][id][0])){list+=this.helperEval(null,ev[1][id][1],this.helperArrays(ev[0][1],i)),isResolved=!0;break}}}isResolved||(list+=this.helperEval(null,ev[1],this.data[ev[0][1]][i]))}}else if(ev[0][1]instanceof Array)for(let i=0;i<this.helperLength(ev[0][1]);i++)if(exec)for(let id=0;id<ev[1].length;id++){if(ev[1][id][0].includes("[i]")&&(ev[1][id][0]=ev[1][id][0].replace("[i]",`[${i}]`)),ev[1][id][0].includes("default")){list+=this.helperEval(null,ev[1][id][1],"get");break}if(eval(ev[1][id][0])){list+=this.helperEval(null,ev[1][id][1],this.helperArrays(ev[0][1],i));break}}else list+=this.helperEval(null,ev[1],this.helperArrays(ev[0][1],i));else{ev[0][1].includes(".")&&(ev[0][1]=this.helperArrays([ev[0][1]])[0]);for(let i of ev[0][1])if(exec){for(let id=0;id<ev[1].length;id++)if(ev[1][id][0].includes("[i]")&&(ev[1][id][0]=ev[1][id][0].replace("[i]",`[${i}]`)),eval(ev[1][id][0])||ev[1][id][0].includes("default")){list+=this.helperEval(null,ev[1][id][1],i);break}}else list+=this.helperEval(null,ev[1],i)}return this.helperEval(t,list)}helperLength(e=null,t=null){let i=0;for(let l=0;l<e.length;l++){let r=null,s=null;e[l].includes(".")?(r=e[l].split("."),r.map((e=>s=s?s[e]:this.data[e]))):s=this.data[e[l]],Array.isAisArray(s)&&(i=t&&"max"!==t?s.length<i?s.length:i:s.length>i?s.length:i)}return i}helperArrays(e=null,t=null){let i=[];for(let l of e){let e=null,r=null;if("dataLit"===l&&(r=this.data),l.includes(".")&&(e=l.split("."),e.map((e=>{if("dataLit"!==e)return r=r?r[e]:this.data[e]}))),null===t)r?i.push(r):i.push(this.data[l]);else{if(r){if(null!=r[t]){i.push(r[t]);continue}i.push(null);continue}i.push(this.data[l][t])}}return i}helperEval(t=null,ev=null,back=null){if(ev.includes("[[")&&ev.includes("]]")){let parseReg=/\[\[([\s\S]+?)\]\]/g;ev.match(parseReg).map(((e,i)=>{if(back&&!Array.isArray(back)&&"get"!==back)return ev=ev.replace(e,back);if(back instanceof Array&&"get"!==back)return ev=ev.replace(e,back[i]);let extract=e.replace(/\[\[|\]\]/g,"").trim(),dataPairing=null;if(extract.includes("dataLit"))dataPairing=eval(extract);else if(extract.includes(".")){extract=extract.split("."),dataPairing=this.data;for(let e of extract)dataPairing=dataPairing[e]}return console.log(dataPairing),ev=ev.replace(e,`${dataPairing}`)}))}return back?ev:this.string=this.string.replace(t,ev)}render(){try{if(!this.output)return this.getResult;if(Array.isArray(this.output))for(let e of this.output)this.output[e].recursive&&void 0!==this.output[e].recursive?document.querySelectorAll(this.output[e].target).forEach((t=>{void 0!==this.output[e].method?this.helperInsert(t,this.output[e].method):this.helperInsert(t,this.method)})):void 0!==this.output[e].method?this.helperInsert(document.querySelector(this.output[e].target),this.output[e].method):this.helperInsert(document.querySelector(this.output[e].target),this.method);else this.output&&this.method?this.helperInsert(document.querySelector(this.output),this.method):this.helperInsert(document.querySelector("body"),"beforeend")}catch(e){return console.error(e)}}helperInsert(e=null,t=null){try{return t&&"inner"!==t?e.insertAdjacentHTML(t,this.string):e.innerHTML=this.string}catch(e){return console.error(e)}}get getResult(){return this.string}}export{LitGirl as Lit};
